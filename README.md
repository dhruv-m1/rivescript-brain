# rivescript-brain

## Installation

```javascript
npm i rivescript-brain
```

## Usage

`rivescript-brain` offers all the same functionality as rivescript with added classifiaction and middleware functionality.

Language(s) Supported: English.

### Getting Started

```javascript
const rs = require('rivescript-brain');

const bot = new rs({utf8:true});

bot.loadDirectory("./dir/").then(async() => {
    bot.sortReplies();
    // Classifier Setup
    bot.classifier.add('Hello, how are you?', 'casual');
    bot.classifier.train();
    // Getting Reply
    console.log(await bot.reply('username','Hello'));

}).catch((e) => {
    console.trace("Could not load Rive files.", e);
});
```
### The Classifier

In rivescript-brain, a Feed-forward Neural Network is used to classify phrases.

#### Expected Structure of Rive Files
For the classifier to work as intended, it is expected that all conversations in the RiveScript files, are sorted by topic. These topics must be the same as the classifications used to train the classifier. To learn more about topics in RiveScript, please click <a href="https://www.rivescript.com/docs/tutorial#labeled-sections">here</a>.<br/>

#### Saving Image
To save a JSON image of a trained classifier:
```javascript
// Assuming 'bot' is already trained
await bot.classifier.save('./myFilePath/image.json');
```
#### Restoring Image
To restore trained classifier from a saved JSON image:
```javascript
await bot.classifier.restore('./myFilePath/image.json');
```
#### Training
To train a classifier, data must be added first.
```javascript
bot.classifier.add('Hello, how do you do?', 'casual');
```

Classifier training can be initiated as follows:
```javascript
bot.classifier.train();
```
#### Retraining
This feature will be added once <a href="https://github.com/BrainJS/brain.js/issues/427">issue #427</a> is resolved with the brain.js package. Until then, the training function would need to be used with the entire dataset (Note: This will result in downtime in case of a web application).

#### Classifying
```javascript
let result = bot.classifier.classify('Hello, how do you do?');
```
### Managing Discussions
To prevent rivescript-brain's classifier from interfering in <a href = "https://www.rivescript.com/docs/tutorial#short-discussions">short discussions</a>, it is important that there start and end points are marked as folows:
```
+ Hello
- Hi, how are you? <set discussion=true>

+ *
% Hi, how are you?
- May I know your name please?

+ *
% May I know your name please?
- Thanks! How can I help you today? <set name=<star>> <set discussion=false>
```
### The Reply Function
rivescript-brain modifies the stock rivescript reply function to incoperate classifcation and middleware functionality. There is no need to classify and set the convsersation topic seperately. <br/>
Simply use:
```javascript
await bot.reply('username','Hello');
```

### Middleware
Middleware allows for triggering a script based on the response recevied from the rivescript dialog engine.

#### Writing Middleware
Adding a middleware function is simple:
```javascript
bot.middleware.myFunction = (input, output) => {
    return new Promise((resolve) => {

        //Do Something...

        resolve(output);
    })
}
```
Here, `input` refers to the phrase entered by the user and `output` refers to the output generated by the RiveScript engine.
All middleware functions must accept `input` and `output` as arguments and return a promise that ultimalely resolves to `output`.
The output returned by the middleware is what the `reply(input)` function will return.

#### Calling Middleware
Calling middleware from a RiveScript file is very simple. Simply set the `event` variable to the name of the middleware function that you'd like to call:
```
+ tell me fact
- Here you go: <set event=myFunction>
```

**All feedback is appreciated. Please provide your feedback by clicking <a href="https://github.com/dhruv-tech/rivescript-brain/issues">here</a>.**